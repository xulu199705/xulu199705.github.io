{"title":"Linux笔记之VNC配置","uid":"7ac6dc9261475ae0250d6f0f1b0b0bb4","slug":"linux-note-vnc-config","date":"2021-06-21T12:15:24.000Z","updated":"2022-11-22T09:37:18.297Z","comments":true,"path":"api/articles/linux-note-vnc-config.json","keywords":null,"cover":[],"content":"<p>又要当苦力了，自<del>bei</del>愿<del>po</del>学习VNC多用户的配置。成就·学习运维技能之VNC配置，get！</p>\n<p>和XDMCP相同，环境为CentOS 7.8，且已安装GNOME桌面环境。</p>\n<span id=\"more\"></span>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>友情提醒：配置生产用的服务器是务必小心，不熟悉、不自信的同学可以先用虚拟机练练手。</p></blockquote>\n<h2 id=\"预备知识\">1 预备知识</h2>\n<p>下面先简单讲一下VNC是个啥。<del>还是要先装模作样一番的</del></p>\n<p>VNC可以简单理解为桌面级的图像分享系统，可以通过它实现远程控制。<del>就这么简单，更难的我也不会</del></p>\n<p>wikipedia上有详细介绍<a href=\"https://en.m.wikipedia.org/wiki/Virtual_Network_Computing\">VNC的词条</a>，可以过去看看。</p>\n<p>另外，VNC本质上是不需要桌面环境的，即使是CentOS最小安装也是可以使用VNC的；但是呢，这一套就比较麻烦了，所以，懂的都懂，毕竟打工人的干活方式就是能用就行嘛。</p>\n<h2 id=\"安装vnc\">2 安装VNC</h2>\n<h3 id=\"安装桌面环境\">2.1 安装桌面环境</h3>\n<p>首先检查系统内是否有图形界面，我就以GNOME为例，KDE也是类似的。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 检查group列表，看看是否有GNOME Desktop\nyum grouplist</code></pre>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_gnome.png\" alt=\"yum grouplist结果\">\n<figcaption aria-hidden=\"true\">yum grouplist结果</figcaption>\n</figure>\n<p>如果在已安装中有GNOME Desktop，那么就可以跳过桌面环境的安装了。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 安装GNOME Desktop环境\nsudo yum groupinstall -y &quot;GNOME Desktop&quot;</code></pre>\n<p>如果需要调整默认显示模式（命令行/图形桌面），可以使用下面的指令。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 切换为图形桌面\nsudo systemctl set-default graphical.target\n# 切换为命令行\nsudo systemctl set-default multi-user.target</code></pre>\n<h3 id=\"安装vnc组件\">2.2 安装VNC组件</h3>\n<p>VNC组件安装前，可以确认一下使用的镜像源，如果是国外源，可以尝试切换为清华源，切换步骤查看TUNA的<a href=\"https://mirrors.tuna.tsinghua.edu.cn/help/centos/\">CentOS镜像使用帮助</a>。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 安装VNC组件\nyum install tigervnc-server -y\n# 验证VNC安装\nrpm -qa|grep tigervnc-server</code></pre>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_vnc.png\" alt=\"验证VNC安装\">\n<figcaption aria-hidden=\"true\">验证VNC安装</figcaption>\n</figure>\n<h2 id=\"配置vnc\">3 配置VNC</h2>\n<p>VNC安装结束后，需要为每个需要使用的用户配置VNC，本文就简单为2个用户配置一下。其中，<code>leon</code>用户使用的桌面号为<code>1</code>，<code>root</code>用户使用的桌面号为<code>2</code>。<del>注：实际配置过程中，请务必把老板的账号配置为<code>1</code>，以表示尊重</del></p>\n<p>第一步需要依据VNC自带的脚本sample来创建2个VNC启动脚本。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 从sample创建VNC启动脚本\nsudo cp &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;vncserver@.service &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;vncserver@:1.service\nsudo cp &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;vncserver@.service &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;vncserver@:2.service</code></pre>\n<p>命令中的<code>1</code>和<code>2</code>是桌面号，访问VNC时，桌面号不同的脚本对应的端口号不同。VNC访问桌面号<code>1</code>时，使用<code>5900+1=5901</code>端口；问桌面号<code>2</code>时，使用<code>5900+2=5902</code>端口；以此类推。<del>但请不乱推</del></p>\n<p>接着，需要小小处理一下刚刚复制的脚本。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">cd &#x2F;etc&#x2F;systemd&#x2F;system\n# 给权限x\nsudo chmod +x vncserver@\\:1.service\nsudo chmod +x vncserver@\\:2.service</code></pre>\n<p>接着打开2个脚本。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 打开脚本\nsudo vim vncserver@\\:1.service</code></pre>\n<p>将<code>&lt;USER&gt;</code>改为用户名，此处为桌面号<code>1</code>的脚本<code>vncserver@\\:1.service</code>，改为普通用户<code>leon</code>。</p>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_script_1.png\" alt=\"脚本修改前\">\n<figcaption aria-hidden=\"true\">脚本修改前</figcaption>\n</figure>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_script_2.png\" alt=\"脚本修改后\">\n<figcaption aria-hidden=\"true\">脚本修改后</figcaption>\n</figure>\n<p>相同的操作步骤，将<code>vncserver@\\:2.service</code>中的<code>&lt;USER&gt;</code>改为<code>root</code>。</p>\n<p>改完之后，还需要设置一下VNC的连接密码。配置此密码需要在相应的用户下进行，可以使用<code>su</code>（仅能切换到root）或<code>su xxx</code>来进行用户切换。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 配置VNC连接密码\nvncpasswd</code></pre>\n<p>VNC密码配置过程中，首先是主密码的设置；接着是一个进入只读模式的辅助密码，可根据自身需求选择是否进行设置。</p>\n<h2 id=\"启动vnc服务及端口开放\">4 启动VNC服务及端口开放</h2>\n<p>下面是VNC服务的启动和开机自启的配置。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 重载配置文件\nsudo systemctl daemon-reload\n# 启动VNC脚本服务\nsudo systemctl start vncserver@\\:1.service\nsudo systemctl start vncserver@\\:2.service\n# 配置开机自启\nsudo systemctl enable vncserver@\\:1.service\nsudo systemctl enable vncserver@\\:2.service</code></pre>\n<p>检查端口监听情况。<del>注：如果这里看不到端口<code>5901</code>和<code>5902</code>，可以尝试重启，具体原因未知</del></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 检查端口监听\nnetstat -lnpt|grep Xvnc</code></pre>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_port.png\" alt=\"端口监听状态\">\n<figcaption aria-hidden=\"true\">端口监听状态</figcaption>\n</figure>\n<p>防火墙开放端口<code>5901</code>和<code>5902</code>。如果比较大胆的，可以直接把防火墙给关了。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 防火墙开放端口\nfirewall-cmd --zone&#x3D;public --add-port&#x3D;5901&#x2F;tcp --permanent\nfirewall-cmd --zone&#x3D;public --add-port&#x3D;5902&#x2F;tcp --permanent</code></pre>\n<p>关闭SELinux<del>我也不知道这个具体怎么使用，只清楚开着没办法连接¯\\_(\nツ )_/¯</del></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"># 打开SELinux配置文件\nvim &#x2F;etc&#x2F;selinux&#x2F;config</code></pre>\n<p>将横线处改为<code>disabled</code>即可。改为<code>permissive</code>可以连接VNC，但是会报错，且可以屏蔽，自行选择。</p>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_selinux.png\" alt=\"端口监听状态\">\n<figcaption aria-hidden=\"true\">端口监听状态</figcaption>\n</figure>\n<h2 id=\"连接vnc\">5 连接VNC</h2>\n<p>连接桌面号为<code>1</code>，可以使用<code>ip:1</code>或者<code>ip:5901</code>来连接；桌面号为<code>2</code>使用<code>ip:2</code>或者<code>ip:5902</code>。</p>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_pre_1.png\" alt=\"连接VNC地址配置\">\n<figcaption aria-hidden=\"true\">连接VNC地址配置</figcaption>\n</figure>\n<figure>\n<img src=\"/post/linux-note-vnc-config.htm/linux_note_vnc_config_pre_2.png\" alt=\"连接VNC演示\">\n<figcaption aria-hidden=\"true\">连接VNC演示</figcaption>\n</figure>\n<h2 id=\"总结\">6 总结</h2>\n<p>VNC配置到此结束，希望有需求的各位同学能有点收获吧。</p>\n<p>最后的最后，日常求<del>一键三连</del>收藏分享。</p>\n","text":"又要当苦力了，自bei愿po学习VNC多用户的配置。成就·学习运维技能之VNC配置，get！ 和XDMCP相同，环境为CentOS 7.8，且已安装GNOME桌...","link":"","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"软件","slug":"软件","count":4,"path":"api/categories/软件.json"}],"tags":[{"name":"VNC","slug":"VNC","count":1,"path":"api/tags/VNC.json"},{"name":"CentOS","slug":"CentOS","count":2,"path":"api/tags/CentOS.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%A2%84%E5%A4%87%E7%9F%A5%E8%AF%86\"><span class=\"toc-text\">1 预备知识</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85vnc\"><span class=\"toc-text\">2 安装VNC</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">2.1 安装桌面环境</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%AE%89%E8%A3%85vnc%E7%BB%84%E4%BB%B6\"><span class=\"toc-text\">2.2 安装VNC组件</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AEvnc\"><span class=\"toc-text\">3 配置VNC</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%90%AF%E5%8A%A8vnc%E6%9C%8D%E5%8A%A1%E5%8F%8A%E7%AB%AF%E5%8F%A3%E5%BC%80%E6%94%BE\"><span class=\"toc-text\">4 启动VNC服务及端口开放</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%9E%E6%8E%A5vnc\"><span class=\"toc-text\">5 连接VNC</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93\"><span class=\"toc-text\">6 总结</span></a></li></ol>","author":{"name":"Leon","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17242727?s=60&v=4","link":"/","description":"这里是爱研究各种问题、立许多flag的Leon的网络日志","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Tiny Tiny RSS再次搭建","uid":"ddd8f8b95edef17d3014e115ee93b047","slug":"ttrss-build-2","date":"2021-07-22T13:00:27.000Z","updated":"2022-08-18T03:13:04.135Z","comments":true,"path":"api/articles/ttrss-build-2.json","keywords":null,"cover":[],"text":"贫穷的Leon的腾讯云服务器快要到期了(发文章的时候已经到期了)，自用的TTRSS服务岌岌可危，这可咋整啊！！！所幸几周前已经把阿里云上的博客全部迁移到Gith...","link":"","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"DIY","slug":"DIY","count":2,"path":"api/categories/DIY.json"}],"tags":[{"name":"DIY","slug":"DIY","count":5,"path":"api/tags/DIY.json"},{"name":"RSS","slug":"RSS","count":2,"path":"api/tags/RSS.json"},{"name":"服务器","slug":"服务器","count":2,"path":"api/tags/服务器.json"}],"author":{"name":"Leon","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17242727?s=60&v=4","link":"/","description":"这里是爱研究各种问题、立许多flag的Leon的网络日志","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Linux笔记之XDMCP配置","uid":"2ddaee0db5ed68210a2710804d95cdaf","slug":"linux-note-xdmcp-config","date":"2021-04-08T09:55:19.000Z","updated":"2022-08-18T03:09:01.084Z","comments":true,"path":"api/articles/linux-note-xdmcp-config.json","keywords":null,"cover":[],"text":"恰好遇到了服务器远程桌面的需求，记一篇笔记详细介绍一下XDMCP配置。 XDMCP配置主要是XDMCP Server配置、端口打开这两个部分。至于服务器上公网，...","link":"","photos":[],"count_time":{"symbolsCount":"4.4k","symbolsTime":"4 mins."},"categories":[{"name":"软件","slug":"软件","count":4,"path":"api/categories/软件.json"}],"tags":[{"name":"CentOS","slug":"CentOS","count":2,"path":"api/tags/CentOS.json"},{"name":"XDMCP","slug":"XDMCP","count":1,"path":"api/tags/XDMCP.json"},{"name":"Xmanager","slug":"Xmanager","count":1,"path":"api/tags/Xmanager.json"}],"author":{"name":"Leon","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/17242727?s=60&v=4","link":"/","description":"这里是爱研究各种问题、立许多flag的Leon的网络日志","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}